<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IMDb TV Series Sifter</title>
<link rel="icon" href="./favicon.ico" type="image/x-icon">


  <style>
    :root{
      --bg:#0b1020;
      --panel:#121a33;
      --panel2:#0f1730;
      --text:#e9ecff;
      --muted:#aab2d5;
      --accent:#7aa2ff;
      --accent2:#7dffcf;
      --bad:#ff6b6b;
      --line:rgba(255,255,255,.10);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";

      /* ===== Splitter knob (left panel width) ===== */
      --leftW: 460px;

      /* ===== Table column knobs (WIDTHS) ===== */
      --col-title-w: 180px;
      --col-year-w: 80px;
      --col-age-w: 80px;
      --col-rating-w: 80px;
      --col-votes-w: 100px;
      --col-genres-w: 160px;
      --col-score-w: 180px;

      /* ===== Table column knobs (ALIGNMENT) ===== */
      --col-title-align: left;
      --col-year-align: center;
      --col-age-align: center;
      --col-rating-align: center;
      --col-votes-align: center;
      --col-genres-align: left;
      --col-score-align: center;

      /* ===== Table spacing & typography knobs ===== */

      /* Header cell padding */
      --th-pad-y: 2px;
      --th-pad-x: 2px;

      /* Body cell padding */
      --td-pad-y: 2px;
      --td-pad-x: 2px;

      /* Font sizes */
      --th-font-size: 13px;
      --td-font-size: 13px;

      --title-font-size: 13px;
      --meta-font-size: 10px;

    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      background: radial-gradient(1200px 800px at 20% 0%, rgba(122,162,255,.25), transparent 60%),
                  radial-gradient(1000px 700px at 80% 10%, rgba(125,255,207,.18), transparent 55%),
                  var(--bg);
      color:var(--text);
    }
    header{
      padding:28px 18px 10px;
      max-width: 98vw;
      margin: 0 auto;
    }
    h1{
      margin:0 0 6px;
      font-size:22px;
      letter-spacing:.2px;
    }
    .sub{
      margin:0;
      color:var(--muted);
      font-size:13px;
      line-height:1.4;
    }
    .wrap{
      max-width: 98vw;
      margin: 0 auto;
      padding:14px 18px 28px;
    }

    /* ===== Main layout (draggable splitter) ===== */
    .grid{
      display:grid;
      grid-template-columns: var(--leftW) 10px 1fr;
      gap:14px;
      align-items:start;
    }
    .splitter{
      width:10px;
      cursor: col-resize;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      box-shadow: var(--shadow);
      height: 100%;
      min-height: 220px;
    }
    .splitter:hover{
      background: rgba(122,162,255,.18);
      border-color: rgba(122,162,255,.35);
    }
    .splitter.dragging{
      background: rgba(122,162,255,.28);
      border-color: rgba(122,162,255,.55);
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .card h2{
      margin:0;
      padding:14px 14px 10px;
      font-size:14px;
      font-weight:650;
      color:var(--text);
      border-bottom:1px solid var(--line);
      background: rgba(0,0,0,.15);
    }

    .controls{
      padding:12px 14px 14px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px 12px;
    }
    .control{
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    label{
      font-size:12px;
      color:var(--muted);
      user-select:none;
    }
    input, select{
      width:100%;
      padding:10px 10px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(10,14,28,.65);
      color:var(--text);
      outline:none;
      font-size:13px;
    }
    input::placeholder{color:rgba(233,236,255,.35)}
    input:focus, select:focus{border-color: rgba(122,162,255,.55); box-shadow:0 0 0 3px rgba(122,162,255,.18)}

    .btnrow{
      grid-column:1 / -1;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      padding-top:2px;
    }
    button{
      border:0;
      border-radius:12px;
      padding:10px 12px;
      background: rgba(122,162,255,.18);
      color:var(--text);
      cursor:pointer;
      font-weight:650;
      letter-spacing:.2px;
    }
    button:hover{background: rgba(122,162,255,.26)}

    .pill{
      font-family:var(--mono);
      font-size:12px;
      color:var(--muted);
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
    }

    .warn{
      color:var(--bad);
      font-family:var(--mono);
      font-size:12px;
      padding:10px 14px;
      border-top:1px solid var(--line);
      background: rgba(255,107,107,.06);
      display:none;
    }
    .footer{
      padding:10px 14px 14px;
      border-top:1px solid var(--line);
      color:var(--muted);
      font-size:12px;
      display:flex;
      gap:12px;
      justify-content:space-between;
      align-items:center;
      flex-wrap:wrap;
    }
    .kbd{
      font-family:var(--mono);
      border:1px solid rgba(255,255,255,.14);
      border-bottom-color: rgba(255,255,255,.22);
      padding:2px 6px;
      border-radius:8px;
      background: rgba(0,0,0,.20);
      color:var(--text);
      font-size:11px;
    }

    /* ===== Table ===== */
    .tablewrap{
      padding:0;
      overflow: auto;                 /* allows vertical scrolling when needed */
      max-height: calc(100vh - 210px);/* keeps table visible below header on small screens */
      -webkit-overflow-scrolling: touch;
    }


          table{
      width: calc(
        var(--col-title-w) + var(--col-year-w) + var(--col-age-w) +
        var(--col-rating-w) + var(--col-votes-w) + var(--col-genres-w) +
        var(--col-score-w)
      );
      border-collapse:collapse;
      table-layout: fixed;   /* lock column widths */
    }



    thead th{
      position:sticky;
      top:0;
      z-index:2;
      background: rgba(8,12,24,.92);
      backdrop-filter: blur(8px);
      border-bottom:1px solid var(--line);

      padding: var(--th-pad-y) var(--th-pad-x);
      font-size: var(--th-font-size);

      text-align:left;
      color:var(--muted);
      font-weight:650;
      cursor:pointer;
      user-select:none;
      white-space:nowrap;
      overflow:hidden;
    }

    thead th .hint{
      font-size:11px;
      opacity:.75;
      margin-left:6px;
      font-family:var(--mono);
    }

    tbody td{
      border-bottom:1px solid rgba(255,255,255,.06);

      padding: var(--td-pad-y) var(--td-pad-x);
      font-size: var(--td-font-size);

      vertical-align:top;

      /* Never let content force column growth */
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
      max-width: 0;
    }


    tbody tr:hover{
      background: rgba(122,162,255,.10);
    }

    .titlecell{
      display:flex;
      flex-direction:column;
      gap:2px;
      min-width:0;
      overflow-wrap: break-word;
    }
    .titlecell a{
      color: #F5DA55;
      text-decoration:none;
      font-weight:400;
      font-size: var(--title-font-size);
      line-height:1.25;
      white-space:wrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .titlecell a:hover{color:var(--accent)}
    .meta{
      display: none;   /* hide IMDb ID row completely */
    }



    /* ===== Column alignment knobs (7 columns) ===== */
    #tbl th:nth-child(1), #tbl td:nth-child(1){ text-align: var(--col-title-align); }
    #tbl th:nth-child(2), #tbl td:nth-child(2){ text-align: var(--col-year-align); }
    #tbl th:nth-child(3), #tbl td:nth-child(3){ text-align: var(--col-age-align); }
    #tbl th:nth-child(4), #tbl td:nth-child(4){ text-align: var(--col-rating-align); }
    #tbl th:nth-child(5), #tbl td:nth-child(5){ text-align: var(--col-votes-align); }
    #tbl th:nth-child(6), #tbl td:nth-child(6){ text-align: var(--col-genres-align); }
    #tbl th:nth-child(7), #tbl td:nth-child(7){ text-align: var(--col-score-align); }
/* ===== Header alignment mirrors column knobs ===== */
th:nth-child(1){ text-align: var(--col-title-align); }
th:nth-child(2){ text-align: var(--col-year-align); }
th:nth-child(3){ text-align: var(--col-age-align); }
th:nth-child(4){ text-align: var(--col-rating-align); }
th:nth-child(5){ text-align: var(--col-votes-align); }
th:nth-child(6){ text-align: var(--col-genres-align); }
th:nth-child(7){ text-align: var(--col-score-align); }


    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
      .splitter{display:none}
    }
  /* ===== Mobile improvements ===== */

/* Toggle row: desktop/tablet */
.dsWrap{
  display:flex;
  gap:10px;
  align-items:center;
  flex-wrap:wrap;
}
.dsPill{
  margin-left:auto;
}

/* Mobile */
@media (max-width: 900px){
  /* Force single-column layout so Results isn't off-screen */
  body{ overflow-x:hidden; }
  .grid{
    display:block !important;            /* stronger than grid-template tweaks */
  }
  .splitter{ display:none !important; }

  /* Ensure panels take full width */
  .grid > *{
    width:100% !important;
    min-width:0 !important;
  }

  /* Make dataset toggle not overlap */
  .dsWrap{
    flex-direction:column;
    align-items:flex-start;
    gap:8px;
  }
  .dsPill{
    margin-left:0;
  }

  /* Keep table readable with horizontal scroll */
  .tablewrap{
    overflow:auto !important;
    max-height: none !important;
    -webkit-overflow-scrolling: touch;
  }
  table{
    min-width: 900px;
  }

  input, select, button{
    min-height: 40px;
    font-size: 16px;
  }
}

@media (max-width: 900px){
  /* Stack layout instead of side-by-side */
  .grid{
    grid-template-columns: 1fr !important;
  }

  /* Make controls less cramped */
  .panel{
    position: relative !important;
    top: auto !important;
    max-height: none !important;
  }

  /* Bigger touch targets */
  input, select, button{
    min-height: 40px;
    font-size: 16px;
  }

  /* Let table scroll horizontally instead of squishing columns */
  table{
    min-width: 900px;  /* keep columns readable */
  }

  /* Slightly tighter row padding */
  :root{
    --th-pad-y: 10px;
    --th-pad-x: 10px;
    --td-pad-y: 8px;
    --td-pad-x: 10px;
  }
}

</style>

</head>

<body>
<header>
  <h1>IMDb TV Series Sifter</h1>
  <p class="sub">Local CSV-powered filtering and sorting. No tracking. No ads. Just cold, clinical judgment.</p>
</header>

<div class="wrap">
  <div class="grid">
    <div class="card">
      <h2>Controls</h2>

      <div style="padding:12px 14px 0;">
        <div class="sub" style="margin-bottom:6px;">Dataset</div>
        <div class="dsWrap">

          <label style="display:flex; gap:6px; align-items:center; cursor:pointer;">
            <input type="radio" name="dataset" id="dsTv" checked />
            <span>TV Series</span>
          </label>
          <label style="display:flex; gap:6px; align-items:center; cursor:pointer;">
            <input type="radio" name="dataset" id="dsMovies" />
            <span>Movies</span>
          </label>
          <span class="pill dsPill" id="dsLabel">TV Series</span>

        </div>
      </div>

      <div class="controls">
        <div class="control" style="grid-column:1/-1">
          <label>Load CSV (tvseries_ratings.csv)</label>
          <input id="file" type="file" accept=".csv" />
          <div class="sub" style="margin-top:2px;">Tip: keep the CSV in the same folder as this HTML for your own sanity.</div>
        </div>

        <div class="control">
          <label>Title search</label>
          <input id="q" type="text" placeholder="breaking, sopranos, office..." />
        </div>

        <div class="control">
          <label>Genre contains</label>
          <input id="genre" type="text" placeholder="Drama, Comedy, Sci-Fi..." />
        </div>

        <div class="control">
          <label>Min rating</label>
          <input id="minRating" type="number" step="0.1" min="0" max="10" value="8.0" />
        </div>

        <div class="control">
          <label>Min votes</label>
          <input id="minVotes" type="number" step="100" min="0" value="10000" />
        </div>

        <div class="control">
          <label>Year from</label>
          <input id="yearFrom" type="number" min="1900" max="2100" placeholder="e.g. 1990" />
        </div>

        <div class="control">
          <label>Year to</label>
          <input id="yearTo" type="number" min="1900" max="2100" placeholder="e.g. 2025" />
        </div>

        <div class="control">
          <label>Sort by</label>
          <select id="sort">
            <option value="weighted">Weighted score (rating + votes)</option>
            <option value="averageRating">Rating</option>
            <option value="numVotes">Votes</option>
            <option value="startYear">Start year</option>
            <option value="age">Age</option>
            <option value="primaryTitle">Title</option>
          </select>
        </div>

        <div class="control">
          <label>Direction</label>
          <select id="dir">
            <option value="desc">High → low</option>
            <option value="asc">Low → high</option>
          </select>
        </div>

        <div class="btnrow">
          <button id="reset">Reset filters</button>
          <span class="pill" id="status">No file loaded</span>
        </div>
      </div>
      <div class="warn" id="warn"></div>
      <div class="footer">
        <div>Click table headers to sort quickly. Keyboard: <span class="kbd">/</span> focuses search.</div>
        <div class="sub">IMDb links included for external validation.</div>
      </div>
    </div>

    <div class="splitter" id="splitter" title="Drag to resize"></div>

    <div class="card tablewrap">
      <h2>Results</h2>

      <div style="max-height:70vh; overflow:auto; overflow-x:auto;">
        <table id="tbl">
          <!-- Column widths driven by CSS variables above -->
          <colgroup>
            <col style="width: var(--col-title-w);" />
            <col style="width: var(--col-year-w);" />
            <col style="width: var(--col-age-w);" />
            <col style="width: var(--col-rating-w);" />
            <col style="width: var(--col-votes-w);" />
            <col style="width: var(--col-genres-w);" />
            <col style="width: var(--col-score-w);" />
          </colgroup>

          <thead>
            <tr>
              <th data-key="primaryTitle">Title <span class="hint">⇅</span></th>
              <th data-key="startYear">Year <span class="hint">⇅</span></th>
              <th data-key="age">Age <span class="hint">⇅</span></th>
              <th data-key="averageRating">Rating <span class="hint">⇅</span></th>
              <th data-key="numVotes">Votes <span class="hint">⇅</span></th>
              <th data-key="genres">Genres <span class="hint">⇅</span></th>
              <th data-key="weighted">Score <span class="hint">⇅</span></th>
            </tr>
          </thead>

          <tbody id="body">
            <tr><td colspan="7" class="sub">Load tvseries_ratings.csv to see results.</td></tr>
          </tbody>
        </table>
      </div>

    </div>
  </div>
</div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);
  const root = document.documentElement;

  const els = {
    file: $("file"),
    q: $("q"),
    genre: $("genre"),
    minRating: $("minRating"),
    minVotes: $("minVotes"),
    yearFrom: $("yearFrom"),
    yearTo: $("yearTo"),
    sort: $("sort"),
    dir: $("dir"),
    reset: $("reset"),
    status: $("status"),
    warn: $("warn"),
    body: $("body"),
    tbl: $("tbl"),
    splitter: $("splitter"),

    // dataset toggle
    dsTv: $("dsTv"),
    dsMovies: $("dsMovies"),
    dsLabel: $("dsLabel"),

  };

  let all = [];
  const nowYear = new Date().getFullYear();

  function csvParse(text){
    const rows = [];
    let i = 0, field = "", row = [], inQuotes = false;
    const pushField = () => { row.push(field); field = ""; };
    const pushRow = () => { rows.push(row); row = []; };
    while (i < text.length){
      const c = text[i];
      if (inQuotes){
        if (c === '"'){
          if (text[i+1] === '"'){ field += '"'; i += 2; continue; }
          inQuotes = false; i++; continue;
        }
        field += c; i++; continue;
      } else {
        if (c === '"'){ inQuotes = true; i++; continue; }
        if (c === ','){ pushField(); i++; continue; }
        if (c === '\r'){ i++; continue; }
        if (c === '\n'){ pushField(); pushRow(); i++; continue; }
        field += c; i++; continue;
      }
    }
    if (field.length || row.length){ pushField(); pushRow(); }
    return rows;
  }

  function showWarn(msg){
    els.warn.style.display = "block";
    els.warn.textContent = msg;
  }
  function hideWarn(){
    els.warn.style.display = "none";
    els.warn.textContent = "";
  }

  function toInt(x){
    const n = parseInt(x, 10);
    return Number.isFinite(n) ? n : null;
  }
  function toFloat(x){
    const n = parseFloat(x);
    return Number.isFinite(n) ? n : null;
  }

  function weightedScore(rating, votes){
    const v = Math.max(1, votes);
    return rating * Math.log10(v);
  }

  function normalizeRow(o){
    const year = toInt(o.startYear);
    const rating = toFloat(o.averageRating);
    const votes = toInt(o.numVotes) ?? 0;
    const age = year ? (nowYear - year) : null;
    const w = (rating != null) ? weightedScore(rating, votes) : null;
    return {
      tconst: o.tconst,
      primaryTitle: o.primaryTitle || "",
      startYear: year,
      genres: o.genres || "",
      averageRating: rating,
      numVotes: votes,
      age,
      weighted: w
    };
  }

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, m => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[m]));
  }

  function render(rows){
    const maxRows = 3000;
    const slice = rows.slice(0, maxRows);
    els.status.textContent = `${rows.length.toLocaleString()} shown (rendering ${slice.length.toLocaleString()})`;

    if (!slice.length){
      els.body.innerHTML = `<tr><td colspan="7" class="sub">No matches. Your filters are too picky. Or humanity is.</td></tr>`;
      return;
    }

    const html = slice.map(r => {
      const imdbUrl = `https://www.imdb.com/title/${r.tconst}/`;
      const year = r.startYear ?? "";
      const age = (r.age != null) ? r.age : "";
      const rating = (r.averageRating != null) ? r.averageRating.toFixed(1) : "";
      const votes = (r.numVotes != null) ? r.numVotes.toLocaleString() : "";
      const score = (r.weighted != null) ? r.weighted.toFixed(3) : "";
      const genres = r.genres || "";
      return `
        <tr>
          <td>
            <div class="titlecell">
              <a href="${imdbUrl}" target="_blank" rel="noopener">${escapeHtml(r.primaryTitle)}</a>
              <div class="meta">${escapeHtml(r.tconst)}</div>
            </div>
          </td>
          <td>${year}</td>
          <td>${age}</td>
          <td>${rating}</td>
          <td>${votes}</td>
          <td>${escapeHtml(genres)}</td>
          <td>${score}</td>
        </tr>
      `;
    }).join("");

    els.body.innerHTML = html;
  }

  function applyFilters(){
    hideWarn();
    if (!all.length){
      els.status.textContent = "No file loaded";
      return render([]);
    }

    const q = els.q.value.trim().toLowerCase();
    const g = els.genre.value.trim().toLowerCase();
    const minR = toFloat(els.minRating.value) ?? 0;
    const minV = toInt(els.minVotes.value) ?? 0;
    const yFrom = toInt(els.yearFrom.value);
    const yTo = toInt(els.yearTo.value);

    let rows = all.filter(r => {
      if (q && !r.primaryTitle.toLowerCase().includes(q)) return false;
      if (g && !(r.genres || "").toLowerCase().includes(g)) return false;
      if (r.averageRating == null || r.averageRating < minR) return false;
      if (r.numVotes == null || r.numVotes < minV) return false;
      if (yFrom != null && (r.startYear == null || r.startYear < yFrom)) return false;
      if (yTo != null && (r.startYear == null || r.startYear > yTo)) return false;
      return true;
    });

    const key = els.sort.value;
    const dir = els.dir.value;

    rows.sort((a,b) => {
      let av = a[key], bv = b[key];
      if (av == null) av = (key === "primaryTitle" ? "" : -Infinity);
      if (bv == null) bv = (key === "primaryTitle" ? "" : -Infinity);

      if (typeof av === "string" || typeof bv === "string"){
        const cmp = String(av).localeCompare(String(bv));
        return dir === "asc" ? cmp : -cmp;
      } else {
        const cmp = (av === bv) ? 0 : (av < bv ? -1 : 1);
        return dir === "asc" ? cmp : -cmp;
      }
    });

    render(rows);
  }

  function resetFilters(){
    els.q.value = "";
    els.genre.value = "";
    els.minRating.value = "8.0";
    els.minVotes.value = "10000";
    els.yearFrom.value = "";
    els.yearTo.value = "";
    els.sort.value = "weighted";
    els.dir.value = "desc";
    applyFilters();
  }

  // Load CSV
 // Load CSV (auto from server, with manual fallback)
async function loadCsvText(text){
  hideWarn();
  const rows = csvParse(text);
  if (!rows.length){
    showWarn("Could not parse CSV.");
    return;
  }

  const header = rows[0];
  const idx = {};
  header.forEach((h, i) => idx[h] = i);

  const required = ["tconst","primaryTitle","startYear","genres","averageRating","numVotes"];
  for (const r of required){
    if (!(r in idx)){
      showWarn(`CSV is missing column "${r}".`);
      return;
    }
  }

  all = rows.slice(1).map(cols => normalizeRow({
    tconst: cols[idx.tconst],
    primaryTitle: cols[idx.primaryTitle],
    startYear: cols[idx.startYear],
    genres: cols[idx.genres],
    averageRating: cols[idx.averageRating],
    numVotes: cols[idx.numVotes],
  }));

els.status.textContent = `Loaded ${all.length.toLocaleString()} rows`;
  if (els.dsLabel) els.dsLabel.textContent = (els.dsMovies && els.dsMovies.checked) ? "Movies" : "TV Series";
  applyFilters();

}

// Auto-load when running on localhost
async function autoLoadDataset(){
  try{
    const csv = (els.dsMovies && els.dsMovies.checked) ? "movies_ratings.csv" : "tvseries_ratings.csv";
    const res = await fetch(csv, { cache: "no-store" });
    if (!res.ok) throw new Error("CSV not found: " + csv);
    const text = await res.text();
    await loadCsvText(text);

    // update dataset pill on success
    if (els.dsLabel) els.dsLabel.textContent = (els.dsMovies && els.dsMovies.checked) ? "Movies" : "TV Series";
  }catch(err){
    const msg = (err && err.message) ? err.message : String(err);
    els.status.textContent = "Auto-load failed: " + msg;
    try { showWarn("Auto-load failed: " + msg); } catch {}
  }
}
// Manual fallback (still available)
els.file.addEventListener("change", async (e) => {
  const f = e.target.files?.[0];
  if (!f) return;
  const text = await f.text();
  await loadCsvText(text);
});


  // Refilter on input
  ["input","change"].forEach(evt => {
    ["q","genre","minRating","minVotes","yearFrom","yearTo","sort","dir"].forEach(id => {
      els[id].addEventListener(evt, applyFilters);
    });
  });

  // Reset
  els.reset.addEventListener("click", resetFilters);

  // Header sorting
  els.tbl.querySelectorAll("thead th[data-key]").forEach(th => {
    th.addEventListener("click", () => {
      const key = th.dataset.key;
      if (els.sort.value === key){
        els.dir.value = (els.dir.value === "asc") ? "desc" : "asc";
      } else {
        els.sort.value = key;
        els.dir.value = "desc";
      }
      applyFilters();
    });
  });

  // Keyboard shortcut: / focuses search
  window.addEventListener("keydown", (e) => {
    if (e.key === "/" && document.activeElement?.tagName !== "INPUT"){
      e.preventDefault();
      els.q.focus();
    }
  });

  // Draggable splitter with persistence
  if (els.splitter){
    const minLeft = 320;
    const maxLeft = 900;

    let dragging = false;

    const onMove = (e) => {
      if (!dragging) return;
      const wrap = document.querySelector(".wrap");
      const rect = wrap.getBoundingClientRect();
      let leftW = e.clientX - rect.left - 18;
      leftW = Math.max(minLeft, Math.min(maxLeft, leftW));
      root.style.setProperty("--leftW", `${Math.round(leftW)}px`);
      localStorage.setItem("imdbLeftW", String(Math.round(leftW)));
    };

    const onUp = () => {
      if (!dragging) return;
      dragging = false;
      els.splitter.classList.remove("dragging");
      document.body.style.userSelect = "";
      window.removeEventListener("mousemove", onMove);
      window.removeEventListener("mouseup", onUp);
    };

    els.splitter.addEventListener("mousedown", (e) => {
      e.preventDefault();
      dragging = true;
      els.splitter.classList.add("dragging");
      document.body.style.userSelect = "none";
      window.addEventListener("mousemove", onMove);
      window.addEventListener("mouseup", onUp);
    });

    const saved = parseInt(localStorage.getItem("imdbLeftW"), 10);
    if (Number.isFinite(saved)){
      root.style.setProperty("--leftW", `${saved}px`);
    }
  }

  // Initial render
  render([]);

// Initial dataset auto-load
autoLoadDataset();

// Dataset toggle: reload CSV when switched
if (els.dsTv) {
  els.dsTv.addEventListener("change", () => { if (els.dsTv.checked) { resetFilters(); autoLoadDataset(); } });
}
if (els.dsMovies) {
  els.dsMovies.addEventListener("change", () => { if (els.dsMovies.checked) { resetFilters(); autoLoadDataset(); } });
}


})();
</script>
</body>
</html>
